layer.use("skin/layer.ext.css",function(){layer.ext&&layer.ext()}),layer.prompt=function(t,e,i){var n={},t=t||{},a={area:["auto","auto"],offset:[t.top||"",""],title:t.title||"\u4fe1\u606f",dialog:{btns:2,type:-1,msg:'<input type="'+function(){return 1===t.type?"password":2===t.type?"file":"text"}()+'" class="xubox_prompt xubox_form" id="xubox_prompt" value="'+(t.val||"")+'" />',yes:function(i){var a=n.prompt.val();""===a?n.prompt.focus():a.replace(/\s/g,"").length>(t.length||1e3)?layer.tips("\u6700\u591a\u8f93\u5165"+(t.length||1e3)+"\u4e2a\u5b57\u6570","#xubox_prompt",2):e&&e(a,i,n.prompt)},no:i},success:function(){n.prompt=$("#xubox_prompt"),n.prompt.focus()}};return 3===t.type&&(a.dialog.msg='<textarea class="xubox_prompt xubox_form xubox_formArea" id="xubox_prompt">'+(t.val||"")+"</textarea>"),$.layer(a)},layer.tab=function(t){var t=t||{},e=t.data||[],i={type:1,border:[0],area:["auto","auto"],bgcolor:"",title:!1,shade:t.shade,offset:t.offset,move:".xubox_tabmove",closeBtn:!1,page:{html:'<div class="xubox_tab" style="'+function(){return t.area=t.area||[],"width:"+(t.area[0]||"500px")+"; height:"+(t.area[1]||"300px")+'">'}()+'<span class="xubox_tabmove"></span><div class="xubox_tabtit">'+function(){var t=e.length,i=1,n="";if(t>0)for(n='<span class="xubox_tabnow">'+e[0].title+"</span>";t>i;i++)n+="<span>"+e[i].title+"</span>";return n}()+'</div><ul class="xubox_tab_main">'+function(){var t=e.length,i=1,n="";if(t>0)for(n='<li class="xubox_tabli xubox_tab_layer">'+(e[0].content||"content\u672a\u4f20\u5165")+"</li>";t>i;i++)n+='<li class="xubox_tabli">'+(e[i].content||"content\u672a\u4f20\u5165")+"</li>";return n}()+'</ul><span class="xubox_tabclose" title="\u5173\u95ed">X</span></div>'},success:function(t){var e=$(".xubox_tabtit").children(),i=$(".xubox_tab_main").children(),n=$(".xubox_tabclose");e.on("click",function(){var t=$(this),e=t.index();t.addClass("xubox_tabnow").siblings().removeClass("xubox_tabnow"),i.eq(e).show().siblings().hide()}),n.on("click",function(){layer.close(t.attr("times"))})}};return $.layer(i)},layer.photos=function(t){var e,i,n,a,r,o,s,l;if(t=t||{},e={imgIndex:1,end:null,html:$("html")},i=$(window),n=t.json,a=t.page,n){if(r=n.data,1!==n.status)return void layer.msg("\u672a\u8bf7\u6c42\u5230\u6570\u636e",2,8);if(e.imgLen=r.length,!(r.length>0))return void layer.msg("\u6ca1\u6709\u4efb\u4f55\u56fe\u7247",2,8);e.thissrc=r[n.start].src,e.pid=r[n.start].pid,e.imgsname=n.title||"",e.name=r[n.start].name,e.imgIndex=n.start+1}else o=$(a.parent).find("img"),s=o.eq(a.start),e.thissrc=s.attr("layer-img")||s.attr("src"),e.pid=s.attr("pid"),e.imgLen=o.length,e.imgsname=a.title||"",e.name=s.attr("alt"),e.imgIndex=a.start+1;return l={type:1,border:[0],area:[(t.html?915:600)+"px","auto"],title:!1,shade:[.9,"#000",!0],shadeClose:!0,offset:["25px",""],bgcolor:"",page:{html:'<div class="xubox_bigimg"><img src="'+e.thissrc+'" alt="'+(e.name||"")+'" layer-pid="'+(e.pid||"")+'"><div class="xubox_imgsee">'+function(){return e.imgLen>1?'<a href="" class="xubox_iconext xubox_prev"></a><a href="" class="xubox_iconext xubox_next"></a>':""}()+'<div class="xubox_imgbar"><span class="xubox_imgtit"><a href="javascript:;">'+e.imgsname+" </a><em>"+e.imgIndex+"/"+e.imgLen+"</em></span></div></div></div>"+function(){return t.html?'<div class="xubox_intro">'+t.html+"</div>":""}()},success:function(t){e.bigimg=t.find(".xubox_bigimg"),e.imgsee=e.bigimg.find(".xubox_imgsee"),e.imgbar=e.imgsee.find(".xubox_imgbar"),e.imgtit=e.imgbar.find(".xubox_imgtit"),e.layero=t;var i=e.imgs=e.bigimg.find("img");clearTimeout(e.timerr),e.timerr=setTimeout(function(){$("html").css("overflow","hidden").attr("layer-full",e.index)},10),i.load(function(){e.imgarea=[i.outerWidth(),i.outerHeight()],e.resize(t)}),e.event()},end:function(){layer.closeAll(),e.end=!0}},e.event=function(){e.bigimg.hover(function(){e.imgsee.show()},function(){e.imgsee.hide()}),l.imgprev=function(){e.imgIndex--,e.imgIndex<1&&(e.imgIndex=e.imgLen),e.tabimg()},e.bigimg.find(".xubox_prev").on("click",function(t){t.preventDefault(),l.imgprev()}),l.imgnext=function(){e.imgIndex++,e.imgIndex>e.imgLen&&(e.imgIndex=1),e.tabimg()},e.bigimg.find(".xubox_next").on("click",function(t){t.preventDefault(),l.imgnext()}),$(document).keyup(function(t){if(!e.end){var i=t.keyCode;t.preventDefault(),37===i?l.imgprev():39===i?l.imgnext():27===i&&layer.close(e.index)}}),e.tabimg=function(){var i,a,s,l,m;e.imgs.removeAttr("style"),n?(l=r[e.imgIndex-1],i=l.src,a=l.pid,s=l.name):(m=o.eq(e.imgIndex-1),i=m.attr("layer-img")||m.attr("src"),a=m.attr("layer-pid")||"",s=m.attr("alt")||""),e.imgs.attr({src:i,"layer-pid":a,alt:s}),e.imgtit.find("em").text(e.imgIndex+"/"+e.imgLen),e.imgsee.show(),t.tab&&t.tab({pid:a,name:s})}},e.resize=function(n){var a,r={},o=[i.width(),i.height()];r.limit=o[0]-o[0]/o[1]*(60*o[0]/o[1]),r.limit<600&&(r.limit=600),a=[r.limit,o[1]>400?o[1]-50:400],a[0]=t.html?a[0]:a[0]-300,layer.area(e.index,{width:a[0]+(t.html?15:0),height:a[1]}),r.flwidth=a[0]-(t.html?300:0),e.imgs.css(e.imgarea[0]>r.flwidth?{width:r.flwidth}:{width:e.imgarea[0]}),e.imgs.outerHeight()<a[1]&&e.imgs.css({top:(a[1]-e.imgs.outerHeight())/2}),e.imgs.css({visibility:"visible"}),e.bigimg.css({width:r.flwidth,height:a[1],"background-color":t.bgcolor}),t.html&&n.find(".xubox_intro").css({height:a[1]}),r=null,o=null,a=null},i.on("resize",function(){e.end||(e.timer&&clearTimeout(e.timer),e.timer=setTimeout(function(){e.resize(e.layero)},200))}),e.index=$.layer(l),e.index},layer.photosPage=function(t){var e={};e.run=function(e){layer.photos({html:t.html,success:t.success,page:{title:t.title,id:t.id,start:e,parent:t.parent}})},t=t||{},$(t.parent).find("img").each(function(t){$(this).on("click",function(){e.run(t)})})};